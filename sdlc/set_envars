#!/bin/bash

# Set Colors and handle errors
source ~/bin/colors

# Load environment variables from .env if present
if [ -f ".env" ]; then
    export $(grep -v '^#' .env | xargs)
fi

# Ensure DJANGO_PROJECT_NAME, RAILWAY_SERVICE_NAME, and RAILWAY_TOKEN are set
if [ -z "$DJANGO_PROJECT_NAME" ]; then
    handle_error "Error: DJANGO_PROJECT_NAME is not set. Please ensure it's defined in your .env file or as an environment variable."
fi

# Check if the app directory exists
if [ ! -d "app" ]; then
    handle_error "Error: 'app' directory does not exist. Ensure you are in the correct project directory."
fi

# Check if manage.py exists in the app directory
if [ ! -f "app/manage.py" ]; then
    handle_error "Error: 'manage.py' not found in the 'app' directory. Please check your project structure."
fi

# Check if the Django wsgi module exists
if [ ! -f "app/$DJANGO_PROJECT_NAME/wsgi.py" ]; then
    handle_error "Error: 'wsgi.py' not found in the 'app/$DJANGO_PROJECT_NAME' directory. Please check your project structure."
fi